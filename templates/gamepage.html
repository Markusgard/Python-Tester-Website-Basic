<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="/static/gpcode.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <form action="" method="POST">
            <textarea name="pyarea" id="pyarea" cols="60" rows="20" v-on:keydown.tab.prevent="indentation"></textarea>
            <input type="button" v-on:click="runCode" value="run">
        </form>
        <div id="console">
            <p v-bind:class="item[0]" v-for="item in consoleItems">[[ item[1] ]]</p>
        </div>
    </div>
</body>
<script>
    Vue.createApp({
        delimiters: ['[[', ']]'],               // Prevent conflicts with Jinja2
        data: function() {
            return {
                consoleItems: [],
            }
        },
        methods: {
            indentation(){
                let textField = document.getElementById("pyarea");      // Prevents default action at tabulator, adds indentation instead
    
                // Get text index at cursor placement
                let start = textField.selectionStart;
                let end = textField.selectionEnd;
    
                // Add indentation at cursor placement
                let newText = textField.value.substring(0, start) + "\t" + textField.value.substring(end);
                textField.value = newText;
            },
    
    
            
            async runCode() {
                let input = document.getElementById("pyarea").value;                // Send the user's code to the python app
                let response = await fetch("/run",{
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: "py="+input
                });
                if (response.status == 200){
                    let result = await response.text();
                    let severity = "";
                    if (result[0] > 1){             // Determines penalty to user
                        severity = "itemBad"
                    }else if (result[0] > 0){severity = "itemCaution"}
                    else{severity = "itemGood"}
                    this.consoleItems.push([severity, result.slice(1)]);
                }
            }
        }
    }).mount("#app");
    
</script>
</html>